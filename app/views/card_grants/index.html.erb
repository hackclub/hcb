<% title "Card grants for #{@event.name}" %>
<% page_md %>
<%= render "events/nav", selected: :card_grants %>

<% if @event.card_grants.active.any? %>
<h1 class="flex heading items-center gap-2 flex-col sm:flex-row mb-2 border-0">
  <span class="flex-grow flex items-center flex-1">
    Card grants
    <%= badge_for @event.card_grants.active.count, class: "bg-muted" %>
  </span>

  <% if organizer_signed_in?(as: :member) %>
    <%= render "card_grants/create_modal" %>
    <div class="flex gap-2 items-center">
      <% if policy(@event).bulk_upload_card_grants? %>
        <%= link_to event_card_grants_bulk_upload_path(@event), class: "btn btn--primary" do %>
          <%= inline_icon "share" %>
          Upload a CSV
        <% end %>
      <% end %>
      <%= link_to new_event_card_grant_path(@event), class: "btn bg-success", data: { behavior: "modal_trigger", modal: "create_card_grant" }, disabled: !policy(@event.card_grants.build).create? do %>
        <%= inline_icon "card-add" %>
        Send a grant
      <% end %>
    </div>
  <% end %>
</h1>

<%= turbo_frame_tag :card_grant_card_overview, src: event_card_grant_card_overview_path(@event), loading: :eager do %>
  <%= render "application/loading_container", klass: "mt-8" %>
<% end %>

<h2 class="heading mt4 pb1">Card grant transactions</h2>
<%= turbo_frame_tag :card_grant_transaction_overview, src: event_card_grant_transaction_overview_path(@event), loading: :eager do %>
  <%= render "application/loading_container", klass: "mt-8" %>
<% end %>
<% else %>

 <%= render "events/blankslate_page",
    title: "Card grants",
    support_article: "https://help.hcb.hackclub.com/en/articles/13370871-how-do-i-spend-my-money-on-hcb-and-use-hcb-cards",
    screenshots: {
      light: "https://user-cdn.hackclub-assets.com/019c3c76-536d-7efe-8ce6-2a31869ee3f1/hcb.hackclub.com_hq_card_grants.png",
      dark: "https://user-cdn.hackclub-assets.com/019c3c76-3749-7024-83f1-5c45cd847f79/hcb.hackclub.com_hq_card_grants%20(1).png"
    },
    hints: [
      {
        icon: "card",
        title: "Easily issue spendable cards to anyone",
        description: "No processing checks, reviewing receipts, or managing multiple payment methodsâ€”just deposit funds once"
      },
      {
        icon: "view",
        title: "No reimbursement hassles",
        description: "Recipients spend grant money directly using cards instead of submitting expense reports to you"
      },
      {
        icon: "docs",
        title: "Verify receipts",
        description: "Recipients must submit receipts for all card transactions, ensuring accountability and transparency."
      }
    ] do %>
    <% content_for :caption do %>
      <span class="text-sm text-muted">See <a href="https://hcb.hackclub.com/hq/donations" target="_blank" class="underline">our HQ's donations!</a></span>
    <% end %>
    <% if organizer_signed_in?(as: :member) %>
      <%= link_to event_cards_new_path(event_id: @event.slug), class: "btn bg-success", data: { behavior: "modal_trigger", modal: "order_card" } do %>
        <%= inline_icon "card-add" %>
        Order a card
      <% end %>
    <% end %>

  <% end %>
<% end %>
