<% title "Tell us about your project" %>

<% content_for :progress, 25 %>

<% content_for :info_pane do %>
  <div class="flex flex-col">
    <h2 class="text-4xl">
      Tell us about your project
    </h2>

    <p class="mt-0 text-lg muted">Help our team understand your mission</p>
  </div>
<% end %>

<%= form_with model: @application, url: application_path(@application), method: :patch, id: "edit_application_#{@application.id}", class: "mt-7", data: { action: "input->application-autosave#save", "application-autosave-target": "form" } do |form| %>
  <div class="card card--outline mb-6" x-data="{ has_website: '<%= @application.website_url.present? ? "true" : "false" %>', has_political: '<%= @application.political_description.present? ? "true" : "false" %>', teenager: '<%= @application.teen_led? ? "true" : "false" %>' }">
    <%= form.label :teen_led do %>
      Are you a teenager? <span class="text-primary">*</span>
    <% end %>

    <p class="text-sm muted mt-1 mb-2">HCB primarily focuses on teen-led projects, so we're more selective with adult-run organizations.</p>

    <div class="field field--options max-w-none">
      <%= form.radio_button :teen_led, "true", { "x-model": "teenager", checked: @application.teen_led? } %>
      <%= form.label :teen_led, value: "true" do %>
        <strong>Yes, I'm a teenager</strong>
        <small>18 and under</small>
      <% end %>
      <%= form.radio_button :teen_led, "false", { "x-model": "teenager", checked: @application.teen_led? == false } %>
      <%= form.label :teen_led, value: "false" do %>
        <strong>No, I'm an adult</strong>
        <small>Over 18</small>
      <% end %>
    </div>

    <div class="field">
      <%= form.label :name do %>
        Project name <span class="text-primary">*</span>
      <% end %>
      <%= form.text_field :name, placeholder: "Leosia Hacks", class: "w-full !max-w-full", required: true, "x-bind:disabled": "teenager == null" %>
    </div>

    <div class="field">
      <%= form.label :description do %>
        Tell us about your project <span class="text-primary">*</span>
      <% end %>
      <p class="text-sm muted mt-1 mb-2">Are you running a hackathon, leading a robotics team, organizing a nonprofit, building a project, or something else? We want to know!</p>
      <%= form.text_area :description, class: "w-full max-w-full", required: true, "x-bind:disabled": "teenager == null" %>
    </div>

    <div class="field">
      <%= form.label :has_website do %>
        Do you have a website? <span class="text-primary">*</span>
      <% end %>
      <%= form.select :has_website, options_for_select([["No", "false"], ["Yes", "true"]], @application.website_url.present? ? "true" : "false"), {}, { "@change": "has_website = $event.target.value; document.getElementById('website_url_field').required = (has_website === 'true'); if (has_website === 'false') document.getElementById('website_url_field').value = ''", class: "w-full max-w-full", required: true, "x-bind:disabled": "teenager == null" } %>
    </div>

    <div class="field" x-show="has_website === 'true'">
      <%= form.label :website_url do %>
        Website URL <span class="text-primary">*</span>
      <% end %>
      <%= form.url_field :website_url, placeholder: "hackclub.com", class: "w-full !max-w-full", id: "website_url_field", data: { controller: "url-validator", action: "blur->url-validator#handleBlur" }, "x-bind:disabled": "teenager == null" %>
    </div>

    <div class="field">
      <%= form.label :has_political do %>
        Is your project involved with political activity? <span class="text-primary">*</span>
      <% end %>
      <p class="text-sm muted mt-1 mb-2">This includes but is not limited to protests, public demonstrations, political education, and lobbying.</p>
      <%= form.select :has_political, options_for_select([["No", "false"], ["Yes", "true"]], @application.political_description.present? ? "true" : "false"), {}, { "@change": "has_political = $event.target.value; document.getElementById('political_description_field').required = (has_political === 'true')", class: "w-full max-w-full", required: true, "x-bind:disabled": "teenager == null" } %>
    </div>

    <div class="field" x-show="has_political === 'true'">
      <%= form.label :political_description do %>
        Please describe the political activity your project is involved in <span class="text-primary">*</span>
      <% end %>
      <%= form.text_area :political_description, class: "w-full max-w-full", id: "political_description_field", "x-bind:disabled": "teenager == null" %>
    </div>

    <div class="flex flex-row w-full gap-4 mt-4">
      <div class="field w-full flex-1 flex-shrink-0" x-show="teenager == 'false' || teenager == false">
        <%= form.label :annual_budget do %>
          Annual budget <span class="text-primary">*</span>
        <% end %>

        <div class="flex items-center">
          <div class="input flex gap-2 items-center py-0">
            <span class="bold muted">$</span>
            <%= form.number_field :annual_budget, id: "annual_budget_field", "x-bind:disabled": "teenager == null", placeholder: "500.00", step: 0.01, min: 0.01, "x-required": "teenager == 'false' || teenager == false", data: { controller: "truncate-decimal", action: "truncate-decimal#truncate blur->truncate-decimal#pad", extraction_field: "total" }, class: "!p-0 !border-none !shadow-none min-h-auto" %>
          </div>
        </div>
      </div>

      <div class="field w-full flex-1 flex-shrink-0" x-show="teenager == 'false' || teenager == false">
        <%= form.label :committed_amount do %>
          Committed amount <span class="text-primary">*</span>
        <% end %>
        <div class="flex items-center">
          <div class="input flex gap-2 items-center py-0">
            <span class="bold muted">$</span>
            <%= form.number_field :committed_amount, id: "committed_amount_field", "x-bind:disabled": "teenager == null", placeholder: "500.00", step: 0.01, min: 0.01, "x-required": "teenager == 'false' || teenager == false", data: { controller: "truncate-decimal", action: "truncate-decimal#truncate blur->truncate-decimal#pad", extraction_field: "total" }, class: "!p-0 !border-none !shadow-none min-h-auto" %>
          </div>
        </div>
      </div>
    </div>
  </div>

<% end %>

<% content_for :footer do %>
  <button class="btn bg-muted" formnovalidate="formnovalidate" formaction="<%= application_path(@application, return_to: application_path(@application)) %>" form="edit_application_<%= @application.id %>">← Back</button>
  <button class="btn bg-blue" formaction="<%= application_path(@application, return_to: personal_info_application_path(@application)) %>" form="edit_application_<%= @application.id %>">Continue →</button>
<% end %>
