<% title "Account settings" %>
<% page_md %>
<% disabled = !policy(current_user).update? %>

<%= render "users/nav", selected: :settings %>

<h1>
  Settings
</h1>
<turbo-frame id="settings" autoscroll data-autoscroll-behavior="smooth">
  <%= render "settings_nav", active: "integrations" %>
  <section>
    <div class="card pb0 mb3">
      <div class="card__banner card__banner--top flex justify-between items-center integration-discord">
        <h3 class="h1 pt2 pb2 my0">Discord</h3>
        <% if current_user.has_discord_account? %>
          <%= link_to(
                "Unlink",
                discord_unlink_user_path,
                data: { turbo_frame: "_top" },
                class: "btn bg-error",
                disabled:
              ) %>
        <% else %>
          <%= link_to(
                "Setup",
                "#",
                data: { turbo_frame: "_top", behavior: "modal_trigger", modal: "discord_integration" },
                class: "btn bg-info",
                disabled:
              ) %>
        <% end %>
      </div>
      <p>
        Install the HCB Discord bot to check your balance, view recent transactions, open reimbursement reports, and more from your team's Discord server!
      </p>
    </div>

    <section class="modal modal--scroll bg-snow" data-behavior="modal" role="dialog" id="discord_integration">
      <%= modal_header "Setup Discord integration" %>

      <p><strong>If your team is already using the HCB Discord integration,</strong> run /link in your team's Discord server.</p>
      <p><strong>If your team isn't using the HCB Discord integration yet,</strong> organization managers can set it up in the organization settings tab.</p>
    </section>
  </section>
</turbo-frame>
