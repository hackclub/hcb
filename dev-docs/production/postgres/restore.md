# Restoring Postgresql from backup
1. Ensure you have postgres installed on the server
2. Ensure you have pgbackrest installed
3. Ensure pgbackrest is configured the exact same as the primary
   copy stanza
4. Stop postgres
5. Nuke all files in Postgres' data directory
   ```bash
   find /var/lib/postgresql/15/main -mindepth 1 -delete
   ```
6. Run the restore
   ```bash
   sudo -u postgres pgbackrest --log-level-console=debug --stanza=hcb_production restore
   ```
   You need log level of at least `detail` to get updates on the restore progress.
7. `cp /var/lib/postgresql/15/main/postgresql.auto.conf /etc/postgresql/15/main/`
   - File seems to be generated by pgbackrest, but it seem to be created in the wrong location. [@albertchae](https://github.com/albertchae) will investigate.
8. Copy remaining WAL from old box
9. `systemctl start postgres`

\- [@garyhtou](https://garytou.com)
